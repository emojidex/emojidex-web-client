/*
 *  emojidex client - v0.2.0
 *  * Provides search, index caching and combining and asset URI resolution
 *  https://github.com/emojidex/emojidex-web-client
 *
 *  =LICENSE=
 *  Licensed under the emojidex Open License
 *  https://www.emojidex.com/emojidex/emojidex_open_license
 *
 *  Copyright 2013 Genshin Souzou Kabushiki Kaisha
 */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l=function(a,b){return function(){return a.apply(b,arguments)}};this.EmojidexClient=function(){function a(a){null==a&&(a={}),this.Util=new j,this.S=new f(a),this.Data=this.S.Data,this.Emoji=this.S.Emoji,this.Categories=this.S.Categories,this.Indexes=this.S.Indexes,this.User=this.S.User,this.Search=new e(this.S)}return a}(),a=function(){function a(a){null==a&&(a=null),this.S=a||new f,this._categories=this.S.Data.categories(),0===this.S.Data.categories().length&&this.sync()}return a.prototype.sync=function(a,b){var c=this;return null==a&&(a=null),null==b&&(b=null),b||(b=this.S.locale),$.getJSON(this.S.api_url+"categories?"+$.param({locale:b})).success(function(b){return c._categories=c.S.Data.categories(b.categories),a?a(b.categories):void 0})},a.prototype.all=function(){return this._categories},a}(),b=function(){function a(a){this.storage=$.localStorage,this.storage.isSet("emojidex")||this.storage.set("emojidex",{}),this.storage.isSet("emojidex.emoji")||this.storage.set("emojidex.emoji",a.emoji||[]),this.storage.isSet("emojidex.history")||this.storage.set("emojidex.history",a.history||[]),this.storage.isSet("emojidex.favorites")||this.storage.set("emojidex.favorites",a.favorites||[]),this.storage.isSet("emojidex.auth_info")||this.storage.set("emojidex.auth_info",a.auth_info||this._def_auth_info())}return a.prototype.emoji=function(a){return null==a&&(a=null),null!==a&&this.storage.set("emojidex.emoji",a),this.storage.get("emojidex.emoji")},a.prototype.favorites=function(a){return null==a&&(a=null),null!==a&&this.storage.set("emojidex.favorites",a),this.storage.get("emojidex.favorites")},a.prototype.history=function(a){return null==a&&(a=null),null!==a&&this.storage.set("emojidex.history",a),this.storage.get("emojidex.history")},a.prototype.categories=function(a){return null==a&&(a=null),null!==a&&this.storage.set("emojidex.categories",a),this.storage.get("emojidex.categories")},a.prototype._def_auth_info=function(){return{status:"none",user:"",token:null}},a.prototype.auth_info=function(a){return null==a&&(a=null),null!==a&&this.storage.set("emojidex.auth_info",a),this.storage.get("emojidex.auth_info")},a}(),c=function(){function a(a){null==a&&(a=null),this.combine=l(this.combine,this),this.S=a||new f,this._emoji=this.S.Data.emoji(),this.util=new j,0===this.S.Data.emoji().length&&this.seed()}return a.prototype.seed=function(a){switch(null===a&&(a=this.S.locale),a){case"en":return this.S.Indexes.user("emoji",this.combine),this.S.Indexes.user("emojidex",this.combine);case"ja":return this.S.Indexes.user("絵文字",this.combine),this.S.Indexes.user("絵文字デックス",this.combine)}},a.prototype.all=function(){return this._emoji},a.prototype.search=function(a,b,c){var d,e;return null==b&&(b=null),null==c&&(c={}),e=function(){var b,c,e,f;for(e=this._emoji,f=[],b=0,c=e.length;c>b;b++)d=e[b],d.code.match(a)&&f.push(d);return f}.call(this),b&&b(e),e},a.prototype.starting=function(a,b,c){var d,e;return null==b&&(b=null),null==c&&(c={}),e=function(){var b,c,e,f;for(e=this._emoji,f=[],b=0,c=e.length;c>b;b++)d=e[b],d.code.match("^"+a)&&f.push(d);return f}.call(this),b&&b(e),e},a.prototype.ending=function(a,b,c){var d,e;return null==b&&(b=null),null==c&&(c={}),e=function(){var b,c,e,f;for(e=this._emoji,f=[],b=0,c=e.length;c>b;b++)d=e[b],d.code.match(a+"$")&&f.push(d);return f}.call(this),b&&b(e),e},a.prototype.tags=function(a,b,c){var d,e,f,g,h,i;for(null==b&&(b=null),null==c&&(c={}),a=this.util.breakout(a),f=c.selection||this._emoji,h=0,i=a.length;i>h;h++)g=a[h],d=function(){var a,b,c;for(c=[],a=0,b=f.length;b>a;a++)e=f[a],$.inArray(g,e.tags)>=0&&c.push(e);return c}();return d},a.prototype.categories=function(a,b,c){var d,e,f,g,h,i;for(null==b&&(b=null),null==c&&(c={}),a=this.util.breakout(a),g=c.selection||this._emoji,e=[],h=0,i=a.length;i>h;h++)d=a[h],$.extend(e,function(){var a,b,c;for(c=[],a=0,b=g.length;b>a;a++)f=g[a],f.category===d&&c.push(f);return c}());return e},a.prototype.advanced=function(a,b,c,d,e){return null==b&&(b=[]),null==c&&(c=[]),null==d&&(d=null),null==e&&(e={}),this.categories(c,null,{selection:this.tags(b,null,{selection:this.search(a)})})},a.prototype.combine=function(a){return this._emoji=this.S.Data.emoji($.extend(this._emoji,a))},a.prototype.flush=function(){return this._emoji=this.S.Data.emoji([])},a}(),d=function(){function a(a){null==a&&(a=null),this.S=a||new f,this.results=[],this.cur_page=1,this.cur_limit=this.S.limit,this.count=0}return a.prototype.index=function(a,b){var c=this;return null==a&&(a=null),this.next=function(){return this.get_index(a,$.extend(b,{page:b.page+1}))},b=this._combine_opts(b),$.getJSON(this.S.api_url+"/emoji?"+$.param(b)).error(function(){return c.results=[]}).success(function(b){return c._succeed(b,a)})},a.prototype.newest=function(a,b){var c=this;return null==a&&(a=null),this.next=function(){return this.get_newest(a,$.extend(b,{page:b.page+1}))},b=this._combine_opts(b),$.getJSON(this.S.api_url+"/newest?"+$.param(b)).error(function(){return c.results=[]}).success(function(b){return c._succeed(b,a)})},a.prototype.popular=function(a,b){var c=this;return null==a&&(a=null),this.next=function(){return this.get_popular(a,$.extend(b,{page:b.page+1}))},b=this._combine_opts(b),$.getJSON(this.S.api_url+"/popular?"+$.param(b)).error(function(){return c.results=[]}).success(function(b){return c._succeed(b,a)})},a.prototype.user=function(a,b,c){var d=this;return null==b&&(b=null),c=this._combine_opts(c),$.getJSON(this.S.api_url+"users/"+a+"/emoji?"+$.param(c)).error(function(){return d.results=[]}).success(function(a){return d._succeed(a,b)})},a.prototype._combine_opts=function(a){return $.extend({page:1,limit:this.S.limit,detailed:this.S.detailed},a)},a.prototype._succeed=function(a,b){return this.results=a.emoji,this.cur_page=a.meta.page,this.count=a.meta.count,this.S.Emoji.combine(a.emoji),b?b(a.emoji):void 0},a}(),e=function(){function a(a){this.S=a||new f,this.Util=new j,this.results=[],this.cur_page=1,this.cur_limit=this.S.limit,this.count=0,this.next=function(){return null}}return a.prototype.search=function(a,b,c){var d=this;return null==b&&(b=null),this.next=function(){return this.search(a,b,$.extend(c,{page:c.page+1}))},this.S.closed_net?this.S.Emoji.search(a,b):(c=this._combine_opts(c),$.getJSON(this.S.api_url+"search/emoji?"+$.param($.extend({},{code_cont:this.Util.escape_term(a)},c))).error(function(){return d.results=[]}).success(function(a){return d._succeed(a,b)})),this.S.Emoji.search(a)},a.prototype.starting=function(a,b,c){var d=this;return null==b&&(b=null),this.next=function(){return this.starting(a,b,$.extend(c,{page:c.page+1}))},this.S.closed_net?this.S.Emoji.starting(a,b):(c=this._combine_opts(c),$.getJSON(this.S.api_url+"search/emoji?"+$.param($.extend({},{code_sw:this.Util.escape_term(a)},c))).error(function(){return d.results=[]}).success(function(a){return d._succeed(a,b)})),this.S.Emoji.starting(a)},a.prototype.ending=function(a,b,c){var d=this;return null==b&&(b=null),this.next=function(){return this.ending(a,b,$.extend(c,{page:c.page+1}))},this.S.closed_net?this.S.Emoji.ending(a,b):(c=this._combine_opts(c),$.getJSON(this.S.api_url+"search/emoji?"+$.param($.extend({},{code_ew:this.Util.escape_term(a)},c))).error(function(){return d.results=[]}).success(function(a){return d._succeed(a,b)})),this.S.Emoji.ending(a)},a.prototype.tags=function(a,b,c){var d=this;return null==b&&(b=null),this.next=function(){return this.tags(term,b,$.extend(c,{page:c.page+1}))},this.S.closed_net?this.S.Emoji.tags(a,b):(c=this._combine_opts(c),$.getJSON(this.S.api_url+"search/emoji?"+$.param($.extend({},{"tags[]":this.Util.breakout(a)},c))).error(function(){return d.results=[]}).success(function(a){return d._succeed(a,b)})),this.S.Emoji.tags(a)},a.prototype.advanced=function(a,b,c,d,e){var f,g=this;return null==b&&(b=[]),null==c&&(c=[]),null==d&&(d=null),this.next=function(){return this.advanced(a,b,c,d,$.extend(e,{page:e.page+1}))},this.S.closed_net?this.S.Emoji.advanced(a,b,c,d):(e=this._combine_opts(e),f={code_cont:this.Util.escape_term(a)},b.length>0&&(f=$.extend(f,{"tags[]":this.Util.breakout(b)})),c.length>0&&(f=$.extend(f,{"categories[]":this.Util.breakout(c)})),$.getJSON(this.S.api_url+"search/emoji?"+$.param($.extend(f,e))).error(function(){return g.results=[]}).success(function(a){return g._succeed(a,d)})),this.S.Emoji.advanced(a,b,c)},a.prototype._combine_opts=function(a){return $.extend({},{page:1,limit:this.S.limit,detailed:this.S.detailed},a)},a.prototype._succeed=function(a,b){return this.results=a.emoji,this.cur_page=a.meta.page,this.count=a.meta.count,this.S.Emoji.combine(a.emoji),b?b(a.emoji):void 0},a}(),f=function(){function e(e){e=$.extend({},this.defaults(),e),this.closed_net=e.closed_net,this.api_url=e.api_url,this.cdn_url=e.cdn_url,this.size_code=e.size_code,this.detailed=e.detailed,this.limit=e.limit,this.locale=e.locale,this.Data=new b(this,e),this.Emoji=new c(this),this.Categories=new a(this),this.User=new g(this),this.Indexes=new d(this)}return e.prototype.defaults=function(){return{locale:"en",api_url:"https://www.emojidex.com/api/v1/",cdn_url:"http://cdn.emojidex.com/emoji",closed_net:!1,min_query_len:4,size_code:"px32",detailed:!1,limit:32}},e}(),k=function(){function a(){console.log("Test Class")}return a.prototype.log=function(a){return console.log(a)},a}(),g=function(){function a(a){null==a&&(a=null),this.S=a||new f,this.auth_info=this.S.Data._def_auth_info(),this.History=new i(this.S),this.Favorites=new h(this.S),this._auto_login()}return a.prototype._auto_login=function(){return this.closed_net?void 0:(this.auth_info=this.S.Data.auth_info(),null!==this.auth_info.token?this.sync_user_data():this.logout())},a.prototype.login=function(a){switch(a.authtype){case"plain":return this.plain_auth(a.username,a.password,a.callback);case"basic":return this.basic_auth(a.user,a.pass,a.callback);case"google":return this.google_auth(a.callback);default:return this._auto_login()}},a.prototype.logout=function(){return this.S.Data.auth_info(this.S.Data._def_auth_info())},a.prototype.plain_auth=function(a,b,c){var d,e=this;return null==c&&(c=null),d=this.S.api_url+"users/authenticate?"+$.param({username:a,password:b}),$.getJSON(d).error(function(a){return e.auth_info=e.S.Data.auth_info({status:a.auth_status,token:null,user:""})}).success(function(a){return e._set_auth_from_response(a),c?c(e.auth_info):void 0})},a.prototype.basic_auth=function(a,b,c){return null==c&&(c=null),!1},a.prototype.google_auth=function(a){return null==a&&(a=null),!1},a.prototype._set_auth_from_response=function(a){return this.auth_info=this.S.Data.auth_info({status:a.auth_status,token:a.auth_token,user:a.auth_user}),this.sync_user_data()},a.prototype.sync_user_data=function(){return this.History.token=this.Favorites.token=this.auth_info.token,this.Favorites.sync(),this.History.sync()},a}(),h=function(){function a(a,b){null==a&&(a=null),null==b&&(b=null),this.S=a||new f,this.token=b,this._favorites=this.S.Data.favorites()}return a.prototype.all=function(){return this._favorites},a.prototype.get=function(){var a=this;return null!=this.token?$.getJSON(this.S.api_url+"users/favorites?"+$.param({auth_token:this.token})).success(function(b){return a._favorites=a.S.Data.favorites(b)}):void 0},a.prototype.set=function(a){var b=this;return null!=this.token?$.ajax({type:"POST",url:this.S.api_url+"users/favorites",data:{auth_token:this.token,emoji_code:a},success:function(){return b._favorites.push(a),b.S.Data.favorites(b._favorites)}}):void 0},a.prototype.unset=function(a){return null!=this.token?$.ajax({type:"DELETE",url:this.S.api_url+"users/favorites",data:{auth_token:this.token,emoji_code:a},success:function(){}}):void 0},a.prototype.sync=function(){return null!=this.token?$.getJSON(this.S.api_url+"users/history?"+$.param({auth_token:this.token})).success(function(){}):void 0},a}(),i=function(){function a(a,b){null==a&&(a=null),null==b&&(b=null),this.S=a||new f,this.token=b,this._history=this.S.Data.history()}return a.prototype.all=function(){return this._history},a.prototype.get=function(){var a=this;return null!=this.token?$.getJSON(this.S.api_url+"users/history?"+$.param({auth_token:this.token})).success(function(b){return a._history=a.S.Data.history(b)}):void 0},a.prototype.set=function(a){var b=this;return null!=this.token?$.ajax({type:"POST",url:this.S.api_url+"users/history",data:{auth_token:this.token,emoji_code:a},success:function(){return b._history.push(a),b.S.Data.history(b._history)}}):void 0},a.prototype.sync=function(){return null!=this.token?$.getJSON(this.S.api_url+"users/history?"+$.param({auth_token:this.token})).success(function(){}):void 0},a}(),j=function(){function a(){}return a.prototype.escape_term=function(a){return a.split(" ").join("_")},a.prototype.de_escape_term=function(a){return a.split("_").join(" ")},a.prototype.breakout=function(a){return null===a?[]:(a instanceof Array||(a=[a]),a)},a.prototype.simplify=function(a,b){var c,d,e,f;for(null==a&&(a=this.results),null==b&&(b=this.size_code),f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push({code:this.Util.escape_term(c.code),img_url:""+this.cdn_url+"/"+b+"/"+this.Util.escape_term(c.code)+".png"});return f},a}()}).call(this);