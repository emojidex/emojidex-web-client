/*
 * emojidex client - v0.9.0
 * * Provides search, index caching and combining and asset URI resolution
 * https://github.com/emojidex/emojidex-web-client
 *
 * =LICENSE=
 * Licensed under the emojidex Open License
 * https://www.emojidex.com/emojidex/emojidex_open_license
 *
 * Copyright 2013 emojidex
 */

!function(a){function b(a,c){c=c||{},this._id=b._generateUUID(),this._promise=c.promise||Promise,this._frameId=c.frameId||"CrossStorageClient-"+this._id,this._origin=b._getOrigin(a),this._requests={},this._connected=!1,this._closed=!1,this._count=0,this._timeout=c.timeout||5e3,this._listener=null,this._installListener();var d;c.frameId&&(d=document.getElementById(c.frameId)),d&&this._poll(),d?this._hub=d.contentWindow:this._createFrame(a)}b.frameStyle={display:"none",position:"absolute",top:"-999px",left:"-999px"},b._getOrigin=function(a){var b,c,d;return b=document.createElement("a"),b.href=a,b.host||(b=window.location),c=b.protocol&&":"!==b.protocol?b.protocol:window.location.protocol,d=c+"//"+b.host,d=d.replace(/:80$|:443$/,"")},b._generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},b.prototype.onReadyFrame=function(){var a=this;return this._hub?this._promise.resolve():this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):new this._promise(function(b,c){var d=setTimeout(function(){c(new Error("CrossStorageClient could not ready frame"))},a._timeout),e=setInterval(function(){a._hub&&(clearTimeout(d),clearInterval(e),b())},100)})},b.prototype.onConnect=function(){var a=this;return this._connected?this._promise.resolve():this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):(this._requests.connect||(this._requests.connect=[]),new this._promise(function(b,c){var d=setTimeout(function(){c(new Error("CrossStorageClient could not connect"))},a._timeout);a._requests.connect.push(function(a){return clearTimeout(d),a?c(a):void b()})}))},b.prototype.set=function(a,b,c){return this._request("set",{key:a,value:b,ttl:c})},b.prototype.get=function(){var a=Array.prototype.slice.call(arguments);return this._request("get",{keys:a})},b.prototype.del=function(){var a=Array.prototype.slice.call(arguments);return this._request("del",{keys:a})},b.prototype.clear=function(){return this._request("clear")},b.prototype.getKeys=function(){return this._request("getKeys")},b.prototype.close=function(){var a=document.getElementById(this._frameId);a&&a.parentNode.removeChild(a),window.removeEventListener?window.removeEventListener("message",this._listener,!1):window.detachEvent("onmessage",this._listener),this._connected=!1,this._closed=!0},b.prototype._installListener=function(){var a=this;this._listener=function(b){var c,d,e,f;if(!a._closed&&b.data&&"string"==typeof b.data&&(d="null"===b.origin?"file://":b.origin,d===a._origin))if("cross-storage:unavailable"!==b.data){if(-1!==b.data.indexOf("cross-storage:")&&!a._connected){if(a._connected=!0,!a._requests.connect)return;for(c=0;c<a._requests.connect.length;c++)a._requests.connect[c](e);delete a._requests.connect}if("cross-storage:ready"!==b.data){try{f=JSON.parse(b.data)}catch(g){return}f.id&&a._requests[f.id]&&a._requests[f.id](f.error,f.result)}}else{if(a._closed||a.close(),!a._requests.connect)return;for(e=new Error("Closing client. Could not access localStorage in hub."),c=0;c<a._requests.connect.length;c++)a._requests.connect[c](e)}},window.addEventListener?window.addEventListener("message",this._listener,!1):window.attachEvent("onmessage",this._listener)},b.prototype._poll=function(){var a,b,c;a=this,c="file://"===a._origin?"*":a._origin,b=setInterval(function(){return a._connected?clearInterval(b):void(a._hub&&a._hub.postMessage("cross-storage:poll",c))},1e3)},b.prototype._createFrame=function(a){var c,d,e=this;c=window.document.createElement("iframe"),c.id=this._frameId;for(d in b.frameStyle)b.frameStyle.hasOwnProperty(d)&&(c.style[d]=b.frameStyle[d]);window.document.body.appendChild(c),c.onload=function(){e._hub=c.contentWindow},c.src=a},b.prototype._request=function(a,b){var c,d;return this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):(d=this,d._count++,c={id:this._id+":"+d._count,method:"cross-storage:"+a,params:b},new this._promise(function(a,b){var e,f,g;e=setTimeout(function(){d._requests[c.id]&&(delete d._requests[c.id],b(new Error("Timeout: could not perform "+c.method)))},d._timeout),d._requests[c.id]=function(f,g){return clearTimeout(e),delete d._requests[c.id],f?b(new Error(f)):void a(g)},Array.prototype.toJSON&&(f=Array.prototype.toJSON,Array.prototype.toJSON=null),g="file://"===d._origin?"*":d._origin,d._hub.postMessage(JSON.stringify(c),g),f&&(Array.prototype.toJSON=f)}))},"undefined"!=typeof module&&module.exports?module.exports=b:"undefined"!=typeof exports?exports.CrossStorageClient=b:"function"==typeof define&&define.amd?define([],function(){return b}):a.CrossStorageClient=b}(this),function(){var a,b,c,d,e,f,g,h,i,j,k=function(a,b){return function(){return a.apply(b,arguments)}};this.EmojidexClient=function(){function c(c){this.env={api_ver:1,cdn_addr:"cdn.emojidex.com",s_cdn_addr:"",asset_addr:"assets.emojidex.com",s_asset_addr:""},this.defaults={locale:"en",api_url:"https://www.emojidex.com/api/v1/",cdn_url:"http://"+this.env.cdn_addr+"/emoji/",closed_net:!1,min_query_len:4,size_code:"px32",detailed:!1,limit:32},this.options=$.extend({},this.defaults,c),this.closed_net=this.options.closed_net,this.api_url=this.options.api_url,this.cdn_url=this.options.cdn_url,this.size_code=this.options.size_code,this.detailed=this.options.detailed,this.limit=this.options.limit,this.locale=this.options.locale,this.Data=new b(this,this.options).then(function(b){return function(c){return b.User=new g(b),b.Indexes=new e(b),b.Util=new j(b),b.Search=new f(b),b.Emoji=new d(b),b.Categories=new a(b)}}(this)).then(function(a){return function(){var b;return"function"==typeof(b=a.options).onReady?b.onReady(a):void 0}}(this))}return c}(),a=function(){function a(a){return this.EC=a,this._categories=this.EC.Data.categories(),this.sync().then(function(a){return function(){return a.EC.Categories=a}}(this))}return a.prototype._categoriesAPI=function(a,b,c,d){var e;return e={page:1,limit:this.EC.limit,detailed:this.EC.detailed},null!==this.EC.User.auth_info.token&&$.extend(e,{auth_token:this.EC.User.auth_info.token}),$.extend(e,c),this.called_func=d,this.called_data={category_name:a,callback:b,param:e},$.ajax({url:this.EC.api_url+"emoji",dataType:"json",data:e,success:function(c){return function(d){return c.meta=d.meta,c.results=d.emoji,c.cur_page=d.meta.page,c.count=d.meta.count,c.EC.Emoji.combine(d.emoji).then(function(){return"function"==typeof b?b(d.emoji,{category_name:a,callback:b,param:e}):void 0})}}(this)})},a.prototype.getEmoji=function(a,b,c){var d;return d={category:a},$.extend(d,c),this._categoriesAPI(a,b,d,this.getEmoji)},a.prototype.next=function(){return this.count===this.called_data.param.limit&&this.called_data.param.page++,this.called_func(this.called_data.category_name,this.called_data.callback,this.called_data.param,{ajax:this.called_func})},a.prototype.prev=function(){return this.called_data.param.page>1&&this.called_data.param.page--,this.called_func(this.called_data.category_name,this.called_data.callback,this.called_data.param,{ajax:this.called_func})},a.prototype.sync=function(a,b){var c;return null!=(null!=(c=this._categories)?c.length:void 0)?new Promise(function(b){return function(c,d){return"function"==typeof a&&a(b._categories),c()}}(this)):(null==b&&(b=this.EC.locale),$.ajax({url:this.EC.api_url+"categories",dataType:"json",data:{locale:b}}).then(function(b){return function(c){return b._categories=c.categories,b.EC.Data.categories(c.categories).then(function(){return"function"==typeof a?a(b._categories):void 0})}}(this)))},a.prototype.all=function(a){return null!=this._categories?"function"==typeof a?a(this._categories):void 0:setTimeout(function(b){return function(){return b.all(a)}}(this),500)},a}(),b=function(){function a(a,b){return this.EC=a,this.options=b,this._def_auth_info={status:"none",user:"",token:null,r18:!1,premium:!1,premium_exp:null,pro:!1,pro_exp:null},null!=this.options.storageHubPath?this.storage=new c(this.options.storageHubPath):this.storage=new c,this.storage.hub.onReadyFrame().then(function(a){return function(){return a.storage.hub.onConnect()}}(this)).then(function(a){return function(){return a.storage.hub.getKeys()}}(this)).then(function(a){return function(b){var c,d,e,f,g;return b.indexOf("emojidex")!==-1?a.storage.update_cache("emojidex"):(a.storage.hub_cache={emojidex:{emoji:(null!=(c=a.EC.options)?c.emoji:void 0)||[],history:(null!=(d=a.EC.options)?d.history:void 0)||[],favorites:(null!=(e=a.EC.options)?e.favorites:void 0)||[],categories:(null!=(f=a.EC.options)?f.categories:void 0)||[],auth_info:(null!=(g=a.EC.options)?g.auth_info:void 0)||a._def_auth_info}},a.storage.update("emojidex",a.storage.hub_cache.emojidex))}}(this)).then(function(a){return function(b){var c,d;return null!=(null!=(c=a.storage.hub_cache)&&null!=(d=c.emojidex)?d.cdn_url:void 0)?a.EC.cdn_url=a.storage.get("emojidex.cdn_url"):a.EC.cdn_url===a.EC.defaults.cdn_url&&a.EC.closed_net===!1?$.ajax({url:a.EC.api_url+"/env",dataType:"json"}).then(function(b){return a.EC.env=b,a.EC.cdn_url="https://"+a.EC.env.s_cdn_addr+"/emoji/",a.storage.update("emojidex",{cdn_url:a.EC.cdn_url})}):void 0}}(this)).then(function(a){return function(b){return a.EC.Data=a}}(this))}return a.prototype.emoji=function(a){var b,c,d,e,f,g,h,i;if(null!=a){if(this.storage.hub_cache.emojidex.emoji.length>0){for(c=this.storage.hub_cache.emojidex.emoji,d=0,f=a.length;d<f;d++)for(h=a[d],e=0,g=c.length;e<g;e++){if(b=c[e],h.code===b.code){c.splice(c.indexOf(b),1,h);break}b===c[c.length-1]&&c.push(h)}return this.storage.update("emojidex",{emoji:c})}return this.storage.update("emojidex",{emoji:a})}return null!=(null!=(i=this.storage.hub_cache.emojidex)?i.emoji:void 0)?this.storage.hub_cache.emojidex.emoji:void 0},a.prototype.favorites=function(a){return null!=a?this.storage.update("emojidex",{favorites:a}):this.storage.hub_cache.favorites},a.prototype.history=function(a){return null!=a?this.storage.update("emojidex",{history:a}):this.storage.hub_cache.history},a.prototype.categories=function(a){return null!=a?this.storage.update("emojidex",{categories:a}):this.storage.hub_cache.categories},a.prototype.auth_info=function(a){return null!=a?(this.EC.User.auth_info=a,this.storage.update("emojidex",{auth_info:a})):this.storage.hub_cache.auth_info},a}(),c=function(){function a(a){null==a&&(a="https://www.emojidex.com/hub/0.8.2"),this.hub=new CrossStorageClient(a,{frameId:"emojidex-client-storage-hub"}),this.hub_cache={}}return a.prototype._get_chained_data=function(a,b,c){var d,e;return null==c&&(c=!0),a=this._get_parsed_query(a),d=function(c,e){return 0===a.array.length?c[e]=b:(c[e]={},d(c[e],a.array.shift())),c},e=d({},a.array.shift()),c?e:e[a.first]},a.prototype._get_hub_data=function(a){return a=a.split("."),this.hub.onConnect().then(function(b){return function(){return b.hub.get(a.shift())}}(this)).then(function(b){var c,d,e;if(a.length)for(c=0,d=a.length;c<d;c++)e=a[c],b=b[e];return b})},a.prototype._get_parsed_query=function(a){var b;return b=a.split("."),a={code:a,array:b,first:b[0]}},a.prototype.get=function(a){var b,c,d,e;if(a=a instanceof Array?a:a.split("."),b=this.hub_cache,a.length)for(c=0,d=a.length;c<d;c++)e=a[c],b=b[e];return b},a.prototype.set=function(a,b,c){var d;return d=a.split(".")[0],this.hub.onConnect().then(function(e){return function(){var f;return c?(f={},f[d]=b,e.hub.set(d,f)):e.hub.set(d,e._get_chained_data(a,b))}}(this)).then(function(a){return function(){return a.update_cache(d)}}(this))},a.prototype.update=function(a,b){var c;return c=$.extend(!0,{},this.get(a.split(".")[0]),this._get_chained_data(a,b,!1)),this.set(a,c,!0)},a.prototype.update_cache=function(a){return this.hub.onConnect().then(function(b){return function(){return a?a:b.hub.getKeys()}}(this)).then(function(a){return function(b){return a.hub.get(b)}}(this)).then(function(b){return function(c){return a?b.hub_cache[a]=c[a]:b.hub_cache=c}}(this))},a.prototype._remove=function(a){var b,c,d;if(a=this._get_parsed_query(a),1===a.array.length)return this.hub.del(a.code);for(d=c=this.get(a.array.shift()),b=0;b<a.array.length-1;)c=c[a.array[b]],b++;return delete c[a.array[b]],this.update(a.first,d)},a.prototype.clear=function(){return this.hub.onConnect().then(function(a){return function(){return a.hub.clear()}}(this))},a.prototype.keys=function(a){var b,c;if(a){c=[];for(b in this.get(a))c.push(b);return c}return this.hub.onConnect().then(function(a){return function(){return a.hub.getKeys()}}(this))},a.prototype.isEmpty=function(a){return!this.get(a)},a.prototype.isSet=function(a){return!!this.get(a)},a}(),d=function(){function a(a){this.EC=a,this.combine=k(this.combine,this),this._emoji_instance=[]}return a.prototype._emoji=function(){return null!=this._emoji_instance?this._emoji_instance:this.checkUpdate()?(this.EC.Data.storage.update("emojidex.seedUpdated",(new Date).toString()),this.seed()):this._emoji_instance=this.EC.Data.storage.get("emojidex.emoji")},a.prototype.checkUpdate=function(){var a,b;return!this.EC.Data.storage.isSet("emojidex.seedUpdated")||(a=new Date,b=new Date(this.EC.Data.storage.get("emojidex.seedUpdated")),a-b>=1728e5)},a.prototype.seed=function(a){return this.EC.Indexes["static"](["utf_emoji","extended_emoji"],null,a)},a.prototype.all=function(){return this._emoji()},a.prototype.search=function(a,b){var c,d;return d=function(){var b,d,e,f;for(e=this._emoji(),f=[],b=0,d=e.length;b<d;b++)c=e[b],c.code.match(a)&&f.push(c);return f}.call(this),"function"==typeof b&&b(d),d},a.prototype.starting=function(a,b){var c,d;return d=function(){var b,d,e,f;for(e=this._emoji(),f=[],b=0,d=e.length;b<d;b++)c=e[b],c.code.match("^"+a)&&f.push(c);return f}.call(this),"function"==typeof b&&b(d),d},a.prototype.ending=function(a,b){var c,d;return d=function(){var b,d,e,f;for(e=this._emoji(),f=[],b=0,d=e.length;b<d;b++)c=e[b],c.code.match(a+"$")&&f.push(c);return f}.call(this),"function"==typeof b&&b(d),d},a.prototype.tags=function(a,b){var c,d,e,f,g,h;for(a=this.EC.Util.breakout(a),g=(null!=b?b.selection:void 0)||this._emoji(),c=[],d=0,e=a.length;d<e;d++)h=a[d],c=c.concat(function(){var a,b,c;for(c=[],a=0,b=g.length;a<b;a++)f=g[a],$.inArray(h,f.tags)>=0&&c.push(f);return c}());return c},a.prototype.categories=function(a,b){var c,d,e,f,g,h;for(a=this.EC.Util.breakout(a),h=(null!=b?b.selection:void 0)||this._emoji(),d=[],e=0,f=a.length;e<f;e++)c=a[e],d=d.concat(function(){var a,b,d;for(d=[],a=0,b=h.length;a<b;a++)g=h[a],g.category===c&&d.push(g);return d}());return d},a.prototype.advanced=function(a){return this.categories(a.categories,{selection:this.tags(a.tags,{selection:this.search(a.term)})})},a.prototype.combine=function(a){return this.EC.Data.emoji(a).then(function(a){return function(b){return a._emoji_instance=b.emoji}}(this))},a.prototype.flush=function(){return this._emoji_instance=[],this.EC.Data.storage._remove("emojidex.emoji")},a}(),e=function(){function a(a){this.EC=a,this.results=[],this.cur_page=1,this.count=0}return a.prototype._indexesAPI=function(a,b,c,d){var e;return e={page:1,limit:this.EC.limit,detailed:this.EC.detailed},null!==this.EC.User.auth_info.token&&$.extend(e,{auth_token:this.EC.User.auth_info.token}),$.extend(e,c),null!=d&&(this.indexed_func=d,this.indexed={query:a,callback:b,param:e}),$.ajax({url:this.EC.api_url+a,dataType:"json",data:e,success:function(a){return function(c){return null!=c.status?(a.results=[],a.cur_page=0,a.count=0,"function"==typeof b?b([]):void 0):(a.meta=c.meta,a.results=c.emoji,a.cur_page=c.meta.page,a.count=c.meta.count,a.EC.Emoji.combine(c.emoji).then(function(a){return"function"==typeof b?b(c.emoji):void 0}))}}(this),error:function(a){return function(c){return a.results=[],a.cur_page=0,a.count=0,"function"==typeof b?b([]):void 0}}(this)})},a.prototype.index=function(a,b){return this._indexesAPI("emoji",a,b,this.index)},a.prototype.newest=function(a,b){return this._indexesAPI("newest",a,b,this.newest)},a.prototype.popular=function(a,b){return this._indexesAPI("popular",a,b,this.popular)},a.prototype.user=function(a,b,c){return this._indexesAPI("users/"+a+"/emoji",b,c)},a.prototype["static"]=function(a,b,c){var d,e,f,g,h,i,j;for(h=0,g=[],f=function(b){return function(d){return $.ajax({url:d,dataType:"json",success:function(d){if(g=g.concat(d),++h===a.length)return b.EC.Emoji.combine(g).then(function(a){return"function"==typeof c?c(a):void 0})}})}}(this),i=[],d=0,e=a.length;d<e;d++)j=a[d],b?i.push(f(this.EC.api_url+j+"?locale="+b)):i.push(f(""+(this.EC.api_url+j)));return i},a.prototype.select=function(a,b,c){return this.EC.Search.find(a,b,c)},a.prototype.next=function(){return this.count===this.indexed.param.limit&&this.indexed.param.page++,this.indexed_func(this.indexed.callback,this.indexed.param,this.indexed_func)},a.prototype.prev=function(){return this.indexed.param.page>1&&this.indexed.param.page--,this.indexed_func(this.indexed.callback,this.indexed.param,this.indexed_func)},a}(),f=function(){function a(a){this.EC=a,this.Util=new j,this.results=[],this.cur_page=1,this.count=0}return a.prototype._searchAPI=function(a,b,c,d){var e;return e={page:1,limit:this.EC.limit,detailed:this.EC.detailed},null!==this.EC.User.auth_info.token&&$.extend(e,{auth_token:this.EC.User.auth_info.token}),$.extend(e,c),this.searched_func=d.ajax,this.searched={data:a,callback:b,param:e},this.EC.closed_net?"function"==typeof d.storage?d.storage(a,b):void 0:$.ajax({url:this.EC.api_url+"search/emoji",dataType:"json",data:e,success:function(a){return function(c){return null!=c.status?(a.results=[],a.cur_page=0,a.count=0,"function"==typeof b?b([]):void 0):(a.meta=c.meta,a.results=c.emoji,a.cur_page=c.meta.page,a.count=c.meta.count,a.EC.Emoji.combine(c.emoji).then(function(a){return"function"==typeof b?b(c.emoji):void 0}))}}(this),error:function(a){return function(c){return a.results=[],a.cur_page=0,a.count=0,"function"==typeof b?b([]):void 0}}(this)})},a.prototype.search=function(a,b,c){return c=$.extend({code_cont:this.EC.Util.escape_term(a)},c),this._searchAPI(a,b,c,{ajax:this.search,storage:this.EC.Emoji.search})},a.prototype.starting=function(a,b,c){return c=$.extend({code_sw:this.Util.escape_term(a)},c),this._searchAPI(a,b,c,{ajax:this.starting,storage:this.EC.Emoji.starting})},a.prototype.ending=function(a,b,c){return c=$.extend({code_ew:this.Util.escape_term(a)},c),this._searchAPI(a,b,c,{ajax:this.ending,storage:this.EC.Emoji.ending})},a.prototype.tags=function(a,b,c){return c=$.extend({"tags[]":this.Util.breakout(a)},c),this._searchAPI(a,b,c,{ajax:this.tags,storage:this.EC.Emoji.tags})},a.prototype.advanced=function(a,b,c){var d;return d={code_cont:this.Util.escape_term(a.term),"tags[]":this.Util.breakout(a.tags),"categories[]":this.Util.breakout(a.categories)},$.extend(d,c),this._searchAPI(a,b,d,{ajax:this.advanced,storage:this.EC.Emoji.advanced})},a.prototype.find=function(a,b,c){var d,e,f,g,h;for(e=this.EC.Data.emoji(),f=0,g=e.length;f<g;f++)if(d=e[f],d.code===a)return"function"==typeof b&&b(d),d;return h={detailed:this.EC.detailed},null!==this.EC.User.auth_info.token&&$.extend(h,{auth_token:this.EC.User.auth_info.token}),$.extend(h,c),$.ajax({url:this.EC.api_url+("emoji/"+a),dataType:"json",data:h,success:function(a){return function(c){return a.EC.Emoji.combine([c]),"function"==typeof b&&b(c),c}}(this),error:function(a){return function(a){return"function"==typeof b&&b(a),a}}(this)})},a.prototype.next=function(){return this.count===this.searched.param.limit&&this.searched.param.page++,this.searched_func(this.searched.data,this.searched.callback,this.searched.param,{ajax:this.searched_func})},a.prototype.prev=function(){return this.searched.param.page>1&&this.searched.param.page--,this.searched_func(this.searched.data,this.searched.callback,this.searched.param,{ajax:this.searched_func})},a}(),g=function(){function a(a){this.EC=a,this.auth_info=this.EC.Data._def_auth_info,this.History=new i(this.EC),this.Favorites=new h(this.EC)}return a.prototype._auto_login=function(){var a,b,c;if("verified"===(null!=(a=this.EC.Data.storage.hub_cache)&&null!=(b=a.emojidex)&&null!=(c=b.auth_info)?c.status:void 0))return this.auth_info=this.EC.Data.storage.hub_cache.emojidex.auth_info,this.sync_user_data()},a.prototype.login=function(a){var b,c,d;switch(a.authtype){case"plain":return this.plain_auth(a.username,a.password,a.callback);case"token":return this.token_auth(a.username,a.auth_token,a.callback);case"basic":return this.basic_auth(a.user,a.password,a.callback);case"google":return this.google_auth(a.callback);case"session":if("verified"===(null!=(b=this.EC.Data.storage.hub_cache)&&null!=(c=b.emojidex)&&null!=(d=c.auth_info)?d.status:void 0))return this.auth_info=this.EC.Data.storage.hub_cache.emojidex.auth_info;break;default:return this._auto_login()}},a.prototype.logout=function(){return this.EC.Data.auth_info(this.EC.Data._def_auth_info)},a.prototype._authenticateAPI=function(a,b){var c;return c={url:this.EC.api_url+"users/authenticate",dataType:"json",success:function(a){return function(c){return a._set_auth_from_response(c).then(function(){return"function"==typeof b?b(a.auth_info):void 0})}}(this),error:function(a){return function(c){var d;return d=JSON.parse(c.responseText),a.auth_info={status:d.auth_status,token:null,user:""},a.EC.Data.auth_info(a.EC.Data.auth_info).then(function(){return"function"==typeof b?b({auth_info:a.auth_info,error_info:c}):void 0})}}(this)},$.ajax($.extend(c,a))},a.prototype.plain_auth=function(a,b,c){return this._authenticateAPI({data:{username:a,password:b}},c)},a.prototype.token_auth=function(a,b,c){return this._authenticateAPI({data:{username:a,token:b}},c)},a.prototype.basic_auth=function(a,b,c){return this._authenticateAPI({data:{user:a,password:b}},c)},a.prototype.google_auth=function(a){return!1},a.prototype.set_auth=function(a,b,c,d,e,f,g){return null==c&&(c=!1),null==d&&(d=!1),null==e&&(e=null),null==f&&(f=!1),null==g&&(g=null),this.EC.Data.auth_info({status:"verified",user:a,token:b,r18:c,premium:d,premium_exp:e,pro:f,pro_exp:g}).then(function(a){return function(b){return a.auth_info=a.EC.Data.storage.get("emojidex.auth_info"),a.sync_user_data(),b}}(this))},a.prototype._set_auth_from_response=function(a){return this.EC.Data.auth_info({status:a.auth_status,token:a.auth_token,user:a.auth_user,r18:a.r18,premium:a.premium,premium_exp:a.premium_exp,pro:a.pro,pro_exp:a.pro_exp}).then(function(a){return function(b){return a.auth_info=a.EC.Data.storage.get("emojidex.auth_info"),a.sync_user_data(),b}}(this))},a.prototype.sync_user_data=function(){return this.History.token=this.Favorites.token=this.auth_info.token,this.Favorites.sync(),this.History.sync()},a}(),h=function(){function a(a,b){this.EC=a,this.token=b,this._favorites=this.EC.Data.favorites()}return a.prototype._favoritesAPI=function(a){var b;if(null!=this.token)return b={url:this.EC.api_url+"users/favorites",dataType:"json"},$.ajax($.extend(b,a))},a.prototype.get=function(a){var b;return b={data:{auth_token:this.token},success:function(b){return function(c){return b._favorites=c,b.EC.Data.favorites(c),"function"==typeof a?a(b._favorites):void 0}}(this)},this._favoritesAPI(b)},a.prototype.set=function(a){var b;return b={type:"POST",data:{auth_token:this.token,emoji_code:a},success:function(a){return function(b){return a._favorites.push(b),a.EC.Data.favorites(a._favorites)}}(this)},this._favoritesAPI(b)},a.prototype.unset=function(a){var b;return b={type:"DELETE",data:{auth_token:this.token,emoji_code:a},success:function(a){return function(b){return a.sync()}}(this)},this._favoritesAPI(b)},a.prototype.sync=function(){return this.get()},a.prototype.all=function(a){return null!=this._favorites?"function"==typeof a&&a(this._favorites):setTimeout(function(b){return function(){return b.all(a)}}(this),500),this._favorites},a}(),i=function(){function a(a,b){this.EC=a,this.token=b,this._history=this.EC.Data.history()}return a.prototype._historyAPI=function(a){var b;if(null!=this.token)return b={url:this.EC.api_url+"users/history",dataType:"json"},$.ajax($.extend(b,a))},a.prototype.get=function(a){var b;return b={data:{auth_token:this.token},success:function(b){return function(c){return b._history=c,b.EC.Data.history(c),"function"==typeof a?a(b._history):void 0}}(this)},this._historyAPI(b)},a.prototype.set=function(a){var b;return b={type:"POST",data:{auth_token:this.token,emoji_code:a},success:function(a){return function(b){var c,d,e,f,g;for(g=a._history,d=e=0,f=g.length;e<f;d=++e)if(c=g[d],c.emoji_code===b.emoji_code)return a._history[d]=b,a.EC.Data.history(a._history),b}}(this)},this._historyAPI(b)},a.prototype.sync=function(){return this.get()},a.prototype.all=function(a){return null!=this._history?"function"==typeof a&&a(this._history):setTimeout(function(b){return function(){return b.all(a)}}(this),500),this._history},a}(),j=function(){function a(a){this.EC=a}return a.prototype.escape_term=function(a){return a.replace(/\s/g,"_").replace(/(\(|\))/g,"\\$1")},a.prototype.de_escape_term=function(a){return a.replace(/_/g," ")},a.prototype.breakout=function(a){return null!=a?a instanceof Array?a:[a]:[]},a.prototype.simplify=function(a,b){var c,d,e,f;for(null==a&&(a=this.results),null==b&&(b=this.EC.size_code),f=[],c=0,d=a.length;c<d;c++)e=a[c],f.push({code:this.escape_term(e.code),img_url:this.EC.cdn_url+"/"+b+"/"+this.escape_term(e.code)+".png"});return f},a}()}.call(this);