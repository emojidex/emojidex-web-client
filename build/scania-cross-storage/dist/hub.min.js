/**
 * scania-cross-storage - Cross domain localStorage, indexedDB and WebSQL using localforage
 *
 * @version   2.0.2
 * @link      https://github.com/mohammed-softordi/cross-storage
 * @author    Mohammed Ayowa <mohammed.ayowa@scania.com>
 * @copyright Zendesk
 * @license   Apache-2.0
 */

!function(e){var t={};t.init=function(e,n){var r=!0;try{n||(r=!1)}catch(o){r=!1}if(!r)try{return window.parent.postMessage("cross-storage:unavailable","*")}catch(o){return}localforage.config(n),t._permissions=e||[],t._installListener(),window.parent.postMessage("cross-storage:ready","*")},t._installListener=function(){var e=t._listener;window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e)},t._listener=function(e){var n,r,o,i,a,s;if(n="null"===e.origin?"file://":e.origin,"cross-storage:poll"===e.data)return window.parent.postMessage("cross-storage:ready",e.origin);if("cross-storage:ready"!==e.data){try{o=JSON.parse(e.data)}catch(f){return}o&&"string"==typeof o.method&&(i=o.method.split("cross-storage:")[1],i&&(t._permitted(n,i)?t["_"+i](o.params).then(function(e){s=JSON.stringify({id:o.id,result:e}),r="file://"===n?"*":n,window.parent.postMessage(s,r)}).catch(function(e){s=JSON.stringify({id:o.id,error:e}),r="file://"===n?"*":n,window.parent.postMessage(s,r)}):a="Invalid permissions for "+i))}},t._permitted=function(e,n){var r,o,i,a;if(r=["get","set","del","clear","getKeys"],!t._inArray(n,r))return!1;for(o=0;o<t._permissions.length;o++)if(i=t._permissions[o],i.origin instanceof RegExp&&i.allow instanceof Array&&(a=i.origin.test(e),a&&t._inArray(n,i.allow)))return!0;return!1},t._set=function(e){return localforage.setItem(e.key,e.value)},t._get=function(e){return localforage.getItem(e.key)},t._del=function(e){return localforage.removeItem(e.key)},t._clear=function(){localforage.clear()},t._getKeys=function(){var e,t;return t=[],localforage.length().then(function(n){for(e=0;n>e;e++)localforage.key(e,function(e){t.push(e)})}).catch(function(e){console.log(e)}),t},t._inArray=function(e,t){for(var n=0;n<t.length;n++)if(e===t[n])return!0;return!1},t._now=function(){return"function"==typeof Date.now?Date.now():(new Date).getTime()},"undefined"!=typeof module&&module.exports?module.exports=t:"undefined"!=typeof exports?exports.CrossStorageHub=t:"function"==typeof define&&define.amd?define([],function(){return t}):e.CrossStorageHub=t}(this);